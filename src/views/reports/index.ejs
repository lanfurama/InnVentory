<%- include('../partials/header') %>
<%- include('../partials/nav') %>
        <%- include('../partials/breadcrumb', { items: [
          { label: typeof t !== 'undefined' ? t('breadcrumb.home') : 'Home', url: '/' },
          { label: typeof t !== 'undefined' ? t('breadcrumb.financials') : 'Financials', url: '/reports' },
          { label: typeof t !== 'undefined' ? t('breadcrumb.reportingAnalytics') : 'Reporting & Analytics' }
        ] }) %>
        <div class="page-header-flex">
          <div>
            <h1 class="page-title"><%= typeof t !== 'undefined' ? t('reports.overview') : 'Financial Reporting & Analytics' %></h1>
            <p class="text-muted mb-0 mt-1" style="font-size: 0.9rem;"><%= typeof t !== 'undefined' ? t('reports.overviewDesc') : 'Generate insights, export data, and track asset performance over time.' %></p>
          </div>
          <div class="page-header-actions">
            <button type="button" class="btn btn-outline-secondary btn-outline-secondary-rounded"><i class="fas fa-calendar-alt mr-1"></i> <%= typeof t !== 'undefined' ? t('reports.scheduleReport') : 'Schedule Report' %></button>
            <button type="button" class="btn btn-primary btn-primary-rounded" onclick="window.print();"><i class="fas fa-file-download mr-1"></i> <%= typeof t !== 'undefined' ? t('reports.exportDashboard') : 'Export Dashboard' %></button>
            <a class="nav-link d-inline-block" href="#" title="<%= typeof t !== 'undefined' ? t('nav.notifications') : 'Notifications' %>"><i class="fas fa-bell"></i></a>
            <a class="nav-link d-inline-block" href="#" title="<%= typeof t !== 'undefined' ? t('nav.help') : 'Help' %>"><i class="fas fa-question-circle"></i></a>
          </div>
        </div>
        </div>
      </div><!-- /.container-fluid -->
    </section>

    <section class="content">
      <div class="container-fluid">

        <div class="filter-section mb-4">
          <form method="get" action="/reports" class="filter-group">
            <div class="filter-item">
              <label><%= typeof t !== 'undefined' ? t('reports.dateRange') : 'DATE RANGE' %></label>
              <select name="date_range" class="form-control form-control-sm">
                <option value="ytd"><%= typeof t !== 'undefined' ? t('reports.thisFiscalYear') : 'This Fiscal Year (YTD)' %></option>
                <option value="last_year"><%= typeof t !== 'undefined' ? t('reports.lastYear') : 'Last Year' %></option>
              </select>
            </div>
            <div class="filter-item">
              <label><%= typeof t !== 'undefined' ? t('reports.department') : 'DEPARTMENT' %></label>
              <select name="department" class="form-control form-control-sm">
                <option value=""><%= typeof t !== 'undefined' ? t('reports.allDepartments') : 'All Departments' %></option>
                <% (departments || []).forEach(function(d) { %>
                <option value="<%= d.id %>"><%= d.name %></option>
                <% }); %>
              </select>
            </div>
            <div class="filter-item">
              <label><%= typeof t !== 'undefined' ? t('reports.assetClass') : 'ASSET CLASS' %></label>
              <select name="asset_class" class="form-control form-control-sm">
                <option value=""><%= typeof t !== 'undefined' ? t('reports.allClasses') : 'All Classes' %></option>
                <% (categories || []).forEach(function(c) { %>
                <option value="<%= c.id %>"><%= c.name %></option>
                <% }); %>
              </select>
            </div>
            <div class="filter-item">
              <button type="submit" class="btn btn-primary btn-sm"><%= typeof t !== 'undefined' ? t('reports.applyFilters') : 'Apply Filters' %></button>
            </div>
          </form>
        </div>

        <div class="dashboard-metrics-row mb-4">
          <div class="metric-card">
            <div class="metric-icon bg-blue">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="metric-content">
              <div class="metric-label"><%= typeof t !== 'undefined' ? t('reports.totalAssetValue') : 'TOTAL ASSET VALUE' %></div>
              <div class="metric-value">$<%= typeof totalValue !== 'undefined' && totalValue ? Number(totalValue).toLocaleString() : '0' %></div>
              <div class="metric-trend positive"><i class="fas fa-arrow-up"></i> +2.4% vs last month</div>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-icon bg-orange">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="metric-content">
              <div class="metric-label"><%= typeof t !== 'undefined' ? t('reports.ytdDepreciation') : 'YTD DEPRECIATION' %></div>
              <div class="metric-value">$<%= typeof totalDepreciation !== 'undefined' && totalDepreciation ? Number(totalDepreciation).toLocaleString() : '0' %></div>
              <div class="metric-trend neutral">+5.1% vs last year</div>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-icon bg-purple">
              <i class="fas fa-th-large"></i>
            </div>
            <div class="metric-content">
              <div class="metric-label"><%= typeof t !== 'undefined' ? t('reports.activeAssets') : 'ACTIVE ASSETS' %></div>
              <div class="metric-value"><%= typeof totalAssets !== 'undefined' ? totalAssets : 0 %></div>
              <div class="metric-trend neutral"><%= typeof t !== 'undefined' ? t('reports.newThisMonth') : 'New' %>: <%= typeof newAssetsThisMonth !== 'undefined' ? newAssetsThisMonth : 0 %> <%= typeof t !== 'undefined' ? t('reports.addedThisMonth') : 'added this month' %></div>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-icon bg-red">
              <i class="fas fa-trash" aria-hidden="true"></i>
            </div>
            <div class="metric-content">
              <div class="metric-label"><%= typeof t !== 'undefined' ? t('reports.disposedAssets') : 'DISPOSED ASSETS' %></div>
              <div class="metric-value"><%= typeof retiredYTD !== 'undefined' ? retiredYTD : 0 %></div>
              <div class="metric-trend neutral"><%= typeof t !== 'undefined' ? t('reports.pendingApproval') : 'Pending approval' %>: 0</div>
            </div>
          </div>
        </div>

        <div class="dashboard-charts-row">
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title"><%= typeof t !== 'undefined' ? t('reports.depreciationTrends') : 'Depreciation Trends' %></h3>
              <a href="/depreciation" class="chart-action"><%= typeof t !== 'undefined' ? t('reports.viewDetails') : 'View Details' %></a>
            </div>
            <div id="reportsDepreciationTrendsChart" style="min-height: 280px;"></div>
          </div>
          <div class="chart-card">
            <div class="chart-header">
              <h3 class="chart-title"><%= typeof t !== 'undefined' ? t('reports.assetDistribution') : 'Asset Distribution' %></h3>
            </div>
            <div id="reportsAssetDistributionChart" style="min-height: 280px;"></div>
          </div>
        </div>
      </div>
    </section>

<script>
(function() {
  var depreciationTrends = <%- JSON.stringify(typeof depreciationTrends !== 'undefined' ? depreciationTrends : []) %>;
  var byCategory = <%- JSON.stringify(typeof byCategory !== 'undefined' ? byCategory : []) %>;
  var categories = depreciationTrends.map(function(r) {
    var m = r.month;
    if (!m) return '';
    var parts = m.split('-');
    var monthNames = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
    return monthNames[parseInt(parts[1], 10) - 1] || m;
  });
  var seriesData = depreciationTrends.map(function(r) { return parseFloat(r.amount) || 0; });
  if (seriesData.length === 0) {
    categories = ['Jan','Apr','Jul','Oct'];
    seriesData = [0, 0, 0, 0];
  }
  var distLabels = byCategory.map(function(c) { return c.name; });
  var distSeries = byCategory.map(function(c) { return parseInt(c.count, 10) || 0; });
  window.dashboardChartConfig = {
    depreciationTrends: { containerId: 'reportsDepreciationTrendsChart', categories: categories, series: seriesData },
    assetDistribution: { containerId: 'reportsAssetDistributionChart', series: distSeries, labels: distLabels }
  };
})();
</script>
<%- include('../partials/footer') %>
